/*
 * Global Stylesheet — app/globals.css
 *
 * This is the single CSS entry point for the entire application.
 * It's imported by app/layout.tsx and applies to all routes.
 *
 * Structure:
 *   1. Tailwind CSS v4 + plugin imports
 *   2. Design tokens (CSS custom properties) — light & dark mode
 *   3. Tailwind @theme mapping (connects tokens to Tailwind utilities)
 *   4. Base layer resets and defaults
 *   5. Custom utility classes
 *   6. Component-specific styles (CodeMirror editor, ProseMirror, scrollbars)
 *   7. NexusChat Malaysian-themed component styles (gradients, animations)
 */

/* ─── Tailwind CSS v4 Core ─────────────────────────────────────────
   Imports the Tailwind engine which processes all utility classes.
   KaTeX provides math equation rendering styles (LaTeX support).
   ─────────────────────────────────────────────────────────────────── */
@import "tailwindcss";
@import "katex/dist/katex.min.css";

/* Tell Tailwind to scan streamdown's output for utility classes it uses */
@source '../node_modules/streamdown/dist/index.js';

/* Dark mode is toggled by adding .dark class to <html> (via next-themes),
   not by @media (prefers-color-scheme) — this allows manual toggle */
@custom-variant dark (&:is(.dark, .dark *));

/* Tailwind plugins: animate provides transition/animation utilities,
   typography provides prose styling for rendered markdown content */
@plugin "tailwindcss-animate";
@plugin "@tailwindcss/typography";

/* ═══════════════════════════════════════════════════════════
   ILMU — MALAYSIAN AI DESIGN SYSTEM
   Inspired by Jalur Gemilang: deep navy blue, gold, red
   "Speak Malaysian, Think Lokal"
   ═══════════════════════════════════════════════════════════ */

/* define design tokens (light mode — Malaysian Dawn) */
:root {
  --background: hsl(220 25% 97%);
  --foreground: hsl(220 30% 8%);
  --card: hsl(0 0% 100%);
  --card-foreground: hsl(220 30% 8%);
  --popover: hsl(0 0% 100%);
  --popover-foreground: hsl(220 30% 8%);
  --primary: hsl(217 71% 45%);
  --primary-foreground: hsl(0 0% 100%);
  --secondary: hsl(220 20% 95%);
  --secondary-foreground: hsl(220 30% 8%);
  --muted: hsl(220 16% 93%);
  --muted-foreground: hsl(220 10% 46%);
  --accent: hsl(45 93% 47%);
  --accent-foreground: hsl(220 30% 8%);
  --destructive: hsl(0 72% 51%);
  --destructive-foreground: hsl(0 0% 100%);
  --border: hsl(220 18% 88%);
  --input: hsl(220 18% 88%);
  --ring: hsl(217 71% 45%);
  --chart-1: hsl(217 71% 45%);
  --chart-2: hsl(45 93% 47%);
  --chart-3: hsl(0 72% 51%);
  --chart-4: hsl(160 84% 39%);
  --chart-5: hsl(280 60% 50%);
  --sidebar-background: hsl(220 25% 96%);
  --sidebar-foreground: hsl(220 15% 28%);
  --sidebar-primary: hsl(217 71% 45%);
  --sidebar-primary-foreground: hsl(0 0% 100%);
  --sidebar-accent: hsl(217 50% 95%);
  --sidebar-accent-foreground: hsl(217 71% 35%);
  --sidebar-border: hsl(220 18% 90%);
  --sidebar-ring: hsl(217 71% 45%);
  /* border radius unit */
  --radius: 0.625rem;
  --sidebar: hsl(220 25% 96%);

  /* Malaysian brand tokens (Jalur Gemilang) */
  --my-blue: hsl(217 71% 45%);
  --my-blue-light: hsl(217 75% 58%);
  --my-gold: hsl(45 93% 47%);
  --my-gold-light: hsl(45 90% 58%);
  --my-red: hsl(0 72% 51%);
  --my-green: hsl(160 84% 39%);
  --my-gradient: linear-gradient(135deg, hsl(217 71% 45%), hsl(45 93% 47%));
  --my-gradient-gold: linear-gradient(135deg, hsl(45 93% 47%), hsl(38 92% 55%));
  --nexus-gradient: linear-gradient(135deg, hsl(217 71% 45%), hsl(45 93% 47%));
  --nexus-gradient-warm: linear-gradient(135deg, hsl(217 71% 45%), hsl(0 72% 51%));
  --nexus-surface-glass: rgba(255, 255, 255, 0.72);
  --nexus-blur: 16px;

  /* Spacing scale (4px base) */
  --space-1: 0.25rem;
  --space-2: 0.5rem;
  --space-3: 0.75rem;
  --space-4: 1rem;
  --space-5: 1.25rem;
  --space-6: 1.5rem;
  --space-8: 2rem;
  --space-10: 2.5rem;
  --space-12: 3rem;
  --space-16: 4rem;

  /* Layout dimensions */
  --nav-rail-width: 72px;
  --sidebar-width: 320px;
  --thread-panel-width: 400px;
  --input-min-height: 56px;
  --input-max-height: 160px;
  --message-max-width: 480px;
  --avatar-sm: 32px;
  --avatar-md: 40px;
  --avatar-lg: 48px;
  --bottom-nav-height: 64px;
}

/* define design tokens (dark mode — Malaysian Night) */
.dark {
  --background: hsl(222 30% 5%);
  --foreground: hsl(220 25% 95%);
  --card: hsl(222 26% 8%);
  --card-foreground: hsl(220 25% 95%);
  --popover: hsl(222 26% 8%);
  --popover-foreground: hsl(220 25% 95%);
  --primary: hsl(217 75% 55%);
  --primary-foreground: hsl(0 0% 100%);
  --secondary: hsl(222 22% 13%);
  --secondary-foreground: hsl(220 25% 95%);
  --muted: hsl(222 20% 14%);
  --muted-foreground: hsl(220 12% 55%);
  --accent: hsl(45 90% 52%);
  --accent-foreground: hsl(222 30% 5%);
  --destructive: hsl(0 63% 45%);
  --destructive-foreground: hsl(0 0% 100%);
  --border: hsl(222 18% 16%);
  --input: hsl(222 18% 16%);
  --ring: hsl(217 75% 55%);
  --chart-1: hsl(217 80% 60%);
  --chart-2: hsl(45 90% 55%);
  --chart-3: hsl(0 72% 58%);
  --chart-4: hsl(160 72% 50%);
  --chart-5: hsl(280 65% 60%);
  --sidebar-background: hsl(222 28% 7%);
  --sidebar-foreground: hsl(220 15% 75%);
  --sidebar-primary: hsl(217 75% 55%);
  --sidebar-primary-foreground: hsl(0 0% 100%);
  --sidebar-accent: hsl(217 40% 15%);
  --sidebar-accent-foreground: hsl(217 80% 80%);
  --sidebar-border: hsl(222 18% 14%);
  --sidebar-ring: hsl(217 75% 55%);
  --sidebar: hsl(222 28% 7%);

  /* Malaysian dark brand tokens */
  --my-blue: hsl(217 80% 60%);
  --my-blue-light: hsl(217 85% 70%);
  --my-gold: hsl(45 90% 55%);
  --my-gold-light: hsl(45 85% 65%);
  --my-red: hsl(0 72% 58%);
  --my-green: hsl(160 72% 50%);
  --my-gradient: linear-gradient(135deg, hsl(217 80% 60%), hsl(45 90% 55%));
  --my-gradient-gold: linear-gradient(135deg, hsl(45 90% 55%), hsl(38 92% 60%));
  --nexus-gradient: linear-gradient(135deg, hsl(217 80% 60%), hsl(45 90% 55%));
  --nexus-gradient-warm: linear-gradient(135deg, hsl(217 80% 60%), hsl(0 72% 58%));
  --nexus-surface-glass: rgba(12, 15, 25, 0.78);
  --nexus-blur: 20px;
}

/* define theme */
@theme {
  --font-sans: var(--font-geist);
  --font-mono: var(--font-geist-mono);

  --breakpoint-toast-mobile: 600px;

  --radius-lg: var(--radius);
  --radius-md: calc(var(--radius) - 2px);
  --radius-sm: calc(var(--radius) - 4px);

  --color-background: var(--background);
  --color-foreground: var(--foreground);

  --color-card: var(--card);
  --color-card-foreground: var(--card-foreground);

  --color-popover: var(--popover);
  --color-popover-foreground: var(--popover-foreground);

  --color-primary: var(--primary);
  --color-primary-foreground: var(--primary-foreground);

  --color-secondary: var(--secondary);
  --color-secondary-foreground: var(--secondary-foreground);

  --color-muted: var(--muted);
  --color-muted-foreground: var(--muted-foreground);

  --color-accent: var(--accent);
  --color-accent-foreground: var(--accent-foreground);

  --color-destructive: var(--destructive);
  --color-destructive-foreground: var(--destructive-foreground);

  --color-border: var(--border);
  --color-input: var(--input);
  --color-ring: var(--ring);

  --color-chart-1: var(--chart-1);
  --color-chart-2: var(--chart-2);
  --color-chart-3: var(--chart-3);
  --color-chart-4: var(--chart-4);
  --color-chart-5: var(--chart-5);

  --color-sidebar: var(--sidebar-background);
  --color-sidebar-foreground: var(--sidebar-foreground);
  --color-sidebar-primary: var(--sidebar-primary);
  --color-sidebar-primary-foreground: var(--sidebar-primary-foreground);
  --color-sidebar-accent: var(--sidebar-accent);
  --color-sidebar-accent-foreground: var(--sidebar-accent-foreground);
  --color-sidebar-border: var(--sidebar-border);
  --color-sidebar-ring: var(--sidebar-ring);
}

/*
  The default border color has changed to `currentcolor` in Tailwind CSS v4,
  so we've added these compatibility styles to make sure everything still
  looks the same as it did with Tailwind CSS v3.

  If we ever want to remove these styles, we need to add an explicit border
  color utility to any element that depends on these defaults.
*/
@layer base {
  *,
  ::after,
  ::before,
  ::backdrop,
  ::file-selector-button {
    border-color: var(--color-gray-200, currentcolor);
  }
}

@utility text-balance {
  text-wrap: balance;
}

@utility -webkit-overflow-scrolling-touch {
  -webkit-overflow-scrolling: touch;
}

@utility touch-pan-y {
  touch-action: pan-y;
}

@utility overscroll-behavior-contain {
  overscroll-behavior: contain;
}

@layer utilities {
  :root {
    --foreground-rgb: 0, 0, 0;
    --background-start-rgb: 214, 219, 220;
    --background-end-rgb: 255, 255, 255;
  }

  @media (prefers-color-scheme: dark) {
    :root {
      --foreground-rgb: 255, 255, 255;
      --background-start-rgb: 0, 0, 0;
      --background-end-rgb: 0, 0, 0;
    }
  }
}

@layer base {
  * {
    @apply border-border;
  }

  body {
    @apply bg-background text-foreground;
    overflow-x: hidden;
    position: relative;
  }

  html {
    overflow-x: hidden;
  }
}

.skeleton {
  * {
    pointer-events: none !important;
  }

  *[class^="text-"] {
    color: transparent;
    @apply rounded-md bg-foreground/20 select-none animate-pulse;
  }

  .skeleton-bg {
    @apply bg-foreground/10;
  }

  .skeleton-div {
    @apply bg-foreground/20 animate-pulse;
  }
}

.ProseMirror {
  outline: none;
}

.cm-editor,
.cm-gutters {
  @apply bg-background! dark:bg-zinc-800! outline-hidden! selection:bg-zinc-900!;
}

.ͼo.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground,
.ͼo.cm-selectionBackground,
.ͼo.cm-content::selection {
  @apply bg-zinc-200! dark:bg-zinc-900!;
}

.cm-activeLine,
.cm-activeLineGutter {
  @apply bg-transparent!;
}

.cm-activeLine {
  @apply rounded-r-sm!;
}

.cm-lineNumbers {
  @apply min-w-7;
}

.cm-foldGutter {
  @apply min-w-3;
}

.cm-lineNumbers .cm-activeLineGutter {
  @apply rounded-l-sm!;
}

.suggestion-highlight {
  @apply bg-blue-200 hover:bg-blue-300 dark:hover:bg-blue-400/50 dark:text-blue-50 dark:bg-blue-500/40;
}

/* minimal scrollbar styling */
::-webkit-scrollbar {
  width: 6px;
  height: 6px;
}

::-webkit-scrollbar-track {
  background: transparent;
}

::-webkit-scrollbar-thumb {
  background: var(--border);
  border-radius: 3px;
  transition: background 0.2s ease;
}

::-webkit-scrollbar-thumb:hover {
  background: --alpha(var(--muted-foreground) / 0.5);
}

::-webkit-scrollbar-corner {
  background: transparent;
}

/* firefox scrollbar styling */
* {
  scrollbar-width: thin;
  scrollbar-color: var(--border) transparent;
}

/* ═══════════════════════════════════════
   NEXUSCHAT COMPONENT STYLES
   ═══════════════════════════════════════ */

/* Malaysian gradient text (blue → gold) */
.nexus-gradient-text {
  background: var(--my-gradient);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

/* Glass morphism surface */
.nexus-glass {
  background: var(--nexus-surface-glass);
  backdrop-filter: blur(var(--nexus-blur));
  -webkit-backdrop-filter: blur(var(--nexus-blur));
}

/* Glow effect for primary actions (Malaysian blue) */
.nexus-glow {
  box-shadow: 0 0 20px -4px hsl(217 71% 45% / 0.35);
}
.dark .nexus-glow {
  box-shadow: 0 0 24px -4px hsl(217 80% 60% / 0.4);
}

/* Message bubble tails */
.nexus-bubble-sent {
  border-radius: 20px 20px 4px 20px;
}
.nexus-bubble-received {
  border-radius: 20px 20px 20px 4px;
}

/* Typing indicator dots animation */
@keyframes nexus-typing-bounce {
  0%, 60%, 100% { transform: translateY(0); }
  30% { transform: translateY(-6px); }
}
.nexus-typing-dot {
  animation: nexus-typing-bounce 1.4s infinite ease-in-out;
}
.nexus-typing-dot:nth-child(2) { animation-delay: 0.15s; }
.nexus-typing-dot:nth-child(3) { animation-delay: 0.3s; }

/* Pulse ring for voice rooms */
@keyframes nexus-pulse-ring {
  0% { transform: scale(0.9); opacity: 0.7; }
  70% { transform: scale(1.15); opacity: 0; }
  100% { transform: scale(0.9); opacity: 0; }
}
.nexus-pulse-ring {
  animation: nexus-pulse-ring 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
}

/* Message entry animation */
@keyframes nexus-msg-in {
  0% { opacity: 0; transform: translateY(12px) scale(0.97); }
  100% { opacity: 1; transform: translateY(0) scale(1); }
}
.nexus-msg-enter {
  animation: nexus-msg-in 0.3s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
}

/* Slide-up panel animation */
@keyframes nexus-slide-up {
  0% { opacity: 0; transform: translateY(100%); }
  100% { opacity: 1; transform: translateY(0); }
}
.nexus-slide-up {
  animation: nexus-slide-up 0.35s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
}

/* Privacy shield shimmer */
@keyframes nexus-shield-shimmer {
  0% { background-position: -200% 0; }
  100% { background-position: 200% 0; }
}
.nexus-shield-shimmer {
  background: linear-gradient(90deg, transparent, hsl(160 84% 39% / 0.15), transparent);
  background-size: 200% 100%;
  animation: nexus-shield-shimmer 3s ease-in-out infinite;
}

/* Encryption lock icon pulse */
@keyframes nexus-lock-pulse {
  0%, 100% { opacity: 0.7; }
  50% { opacity: 1; }
}

/* Navigation rail active indicator */
.nexus-nav-indicator {
  position: relative;
}
.nexus-nav-indicator::before {
  content: '';
  position: absolute;
  left: 0;
  top: 50%;
  transform: translateY(-50%);
  width: 3px;
  height: 20px;
  border-radius: 0 3px 3px 0;
  background: var(--nexus-gradient);
  opacity: 0;
  transition: opacity 0.2s ease;
}
.nexus-nav-indicator[data-active="true"]::before {
  opacity: 1;
}

/* Online presence dot */
.nexus-online-dot {
  box-shadow: 0 0 0 2.5px var(--background);
}

/* Reaction pill hover effect */
.nexus-reaction:hover {
  transform: scale(1.12);
  transition: transform 0.15s ease;
}

@theme inline {
  --color-sidebar: var(--sidebar);
  --color-sidebar-foreground: var(--sidebar-foreground);
  --color-sidebar-primary: var(--sidebar-primary);
  --color-sidebar-primary-foreground: var(--sidebar-primary-foreground);
  --color-sidebar-accent: var(--sidebar-accent);
  --color-sidebar-accent-foreground: var(--sidebar-accent-foreground);
  --color-sidebar-border: var(--sidebar-border);
  --color-sidebar-ring: var(--sidebar-ring);
}

@layer base {
  * {
    @apply border-border outline-ring/50;
  }
  body {
    @apply bg-background text-foreground;
  }
}
